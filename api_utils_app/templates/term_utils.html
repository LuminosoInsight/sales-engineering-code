<script type="text/javascript"
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript">
  var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script type="text/javascript" language="javascript">
  $(function() {
    //CODE FOR MERGE
    //CODE FOR TERM_UTILS_SEARCH STARTS HERE
    $('input[name=submitSearchMerge]').bind('click', function() {
        console.log("sending over:" + $('input[name=acct]').val());
        console.log("sending over:" + $('input[name=proj]').val());
        console.log("sending over:" + $('input[name=query]').val());
      $.getJSON($SCRIPT_ROOT + '/term_utils/search', {
        acct: $('input[name=acct]').val(),
        proj: $('input[name=proj]').val(),
        query: $('input[name=query]').val()
      }, function(data) {
       console.log("data submitted:");
       var search = JSON.stringify(data);
        //$('#result').text(w);

        var obj = JSON.parse(search);

        var selectTermsCode = '<h4>Select which terms you would like to merge:</h4>';
        selectTermsCode += '<form>';
        
        for(var key in obj){
          if (obj.hasOwnProperty(key)){
           var value=obj[key];
           //console.log("key:" + key);
           //console.log("value:" + value);
           selectTermsCode += '<input type="checkbox" name="mergeTerms[]" value="'+value+'"/>'+key;
          }
        }
        selectTermsCode += '<input type="submit" class="btn btn-lg btn-primary btn-block" name="merge" value="Merge"/></form>'

        $('#selectTermsToMerge').html(selectTermsCode);

        $('input[name=merge]').bind('click', function() {
            var terms_checked = [];   
            $('input[name="mergeTerms[]"]:checked').each(function() {
                 terms_checked.push($(this).val());
              });
            var terms_checkedStr = JSON.stringify(terms_checked);
            console.log("sending over:" + $('input[name=acct]').val());
            console.log("sending over:" + $('input[name=proj]').val());
            console.log("terms_checkedStr: " + terms_checkedStr);
            
            $.getJSON($SCRIPT_ROOT + '/term_utils/merge', {
            acct: $('input[name=acct]').val(),
            proj: $('input[name=proj]').val(),
            terms: terms_checkedStr
            }, function(data) {
            console.log("data submitted");
    
            var statusCode = '<h4>Completed.</h4>';
            
            $('#step3').html(statusCode);
            return false;
            }); //end of function(data) for Merge
            return false;
         });  //end of .bind('click') for input[name=merge]

        
        
       
      }); //end of function(data) for submitSearchMerge
  
        return false;
      }); 

  });  //end of function document




</script>



{% extends "index.html" %}

{% block content %}
  

	<div class="page-header"><h1>Term Utils</h1></div>
    <div id="content">
      <h3>Merge terms</h3>

      <span id="credentials">
       <form name="mergeForm">
          <input type="text" name="acct" class="form-control" placeholder="Enter your account ID: ie. admin" required autofocus>
          <input type="text" name="proj" class="form-control" placeholder="Enter your project ID: ie. sd3djr" required>
          <input type="text" name="query" class="form-control" placeholder="Enter your search term: ie. waffles" required>
          <input class="btn btn-lg btn-primary btn-block" type="submit" name="submitSearchMerge" value="Go"/>
        
          <span id="errorSearch">
              {% if error %}<p class=error><strong>Error:</strong> {{ error }}{% endif %}
          </span>
       </form>
      </span>

      <span id="selectTermsToMerge"></span>

      <span id="step3"></span>

      
      <h3>Ignore terms</h3>
      <form name="ignoreForm">
          <input type="text" name="acct" class="form-control" placeholder="Enter your account ID: ie. admin" required autofocus>
          <input type="text" name="proj" class="form-control" placeholder="Enter your project ID: ie. sd3djr" required>
          <input type="text" name="query" class="form-control" placeholder="Enter your search term: ie. waffles" required>
          <input class="btn btn-lg btn-primary btn-block" type="submit" name="submitSearchIgnore" value="Go"/>
        
          <span id="errorSearch">
              {% if error %}<p class=error><strong>Error:</strong> {{ error }}{% endif %}
          </span>
      </form>
    </div> 


{% endblock %}